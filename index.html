<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>German ↔ English Reels — Flashcards</title>

<style>
  :root{
    --bg1: #071028;
    --bg2: #081226;
    --card-bg: rgba(255,255,255,0.02);
    --accent: #8bd3c7;
    --muted: #a6b0c3;
    --glass: rgba(255,255,255,0.03);
    --card-radius: 18px;
  }
  *{box-sizing:border-box}
  html,body{
    height:100%; margin:0;
    font-family:Inter,system-ui; 
    background:linear-gradient(180deg,var(--bg1),var(--bg2));
    color:#eaf2ff;
  }

  body { overflow: hidden !important; } /* YOUR UPDATE */

  .app {
    height:100vh; display:flex;
    align-items:center; justify-content:center;
    padding:20px;
  }

  .viewer {
    width:min(720px,96vw);
    height:min(820px,92vh);
    border-radius:var(--card-radius);
    overflow:hidden;
    background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(255,255,255,0.01));
    box-shadow:0 18px 60px rgba(3,8,20,0.6);
    display:flex; align-items:center; justify-content:center;
    position:relative;
  }

  #cardsRoot { position:absolute; inset:0; }

  .card {
    position:absolute; inset:0;
    padding:30px;
    display:flex; flex-direction:column;
    text-align:center;
    transition:transform 420ms, opacity 300ms;
  }

  /* ★ YOUR CHANGE — more padding above theme */
  .theme {
    text-align:center;
    width:100%;
    padding-top:50px; /* updated */
    padding-bottom:12px;
    border-bottom:1px solid rgba(255,255,255,0.02);
  }
  .theme .title{
    display:inline-block;
    padding:8px 14px;
    border-radius:999px;
    background:var(--glass);
    color:var(--muted);
    font-size:14px;
  }

  .content{
    flex:1; display:flex;
    flex-direction:column;
    justify-content:center; /* top-center layout */
    align-items:center;
    padding:20px 8%;
  }

  .german{
    font-size: clamp(28px, 6.8vw, 56px);
    font-weight:700;
    margin:0;
  }
  .english{
    font-size:clamp(14px,3vw,20px);
    margin-top:16px;
    color:var(--accent);
  }

  /* ★ example sentences reveal on flip */
  .example-box{
    margin-top:20px;
    display:none;
    font-size:15px;
    color:var(--muted);
    line-height:1.4;
  }

  .topbar{position:absolute;left:18px;top:18px; display:flex;gap:10px;}
  .chip{background:var(--glass);padding:8px 12px;border-radius:999px;font-size:13px;color:var(--muted);}

  .hint{position:absolute;right:18px;top:18px;font-size:13px;color:var(--muted);background:var(--glass);padding:8px 12px;border-radius:10px;}

  .bottombar{
    position:absolute;bottom:14px;left:14px;right:14px;
    display:flex;align-items:center;gap:12px;
  }
  .progress{flex:1;height:8px;background:rgba(255,255,255,0.03);border-radius:999px;overflow:hidden;}
  .progress i{height:100%;display:block;background:linear-gradient(90deg,#8bd3c7,#8ac8f0);width:0;}

  .btn{border:1px solid rgba(255,255,255,0.06);background:transparent;padding:8px 10px;color:var(--muted);border-radius:10px;cursor:pointer;}
</style>
</head>

<body>
<div class="app">
  <div class="viewer" id="viewer">

    <div class="topbar">
      <div class="chip" id="countChip">0/0</div>
      <div class="chip">Swipe ↑ / ↓</div>
    </div>
    <div class="hint">Tap to reveal example</div>

    <div id="cardsRoot"></div>

    <div class="bottombar">
      <div class="progress"><i id="progressFill"></i></div>
      <button class="btn" id="prevBtn">Prev</button>
      <button class="btn" id="nextBtn">Next</button>
      <button class="btn" id="shuffleBtn">Shuffle</button>
    </div>

  </div>
</div>

<script>
const FILE_URL = "/mnt/data/file-3.txt";  // uploaded file

let themes = [];
let cards = [];
let index = 0;

/* -----------------------------
   NEW PARSER FOR UPDATED FORMAT
   ----------------------------- */

function rtfToText(raw){
  return raw
    .replace(/\\par[d]?/g,"\n")
    .replace(/\\'[0-9a-fA-F]{2}/g,"")
    .replace(/\\[a-zA-Z]+\d* ?/g,"")
    .replace(/[{}]/g,"")
    .replace(/\r/g,"\n");
}

function parseNewFormat(text) {
  const lines = text
    .split("\n")
    .map(l => l.trim())
    .filter(l => l.length > 0);

  const themes = [];
  let currentTheme = null;
  let lastItem = null;

  const themeRegex = /^\*\s*\d+\.\s*(.+)$/;         // * 6. Wohnen & Einrichtung ...
  const vocabRegex = /^\*\s*(.+?)\s*-\s*(.+)$/;     // * die Wohnung - the apartment
  const satzRegex = /^\*\s*Satz:\s*(.+)$/i;         // * Satz: ...
  const translRegex = /^\*\s*Translation:\s*(.+)$/i;// * Translation: ...

  for (let line of lines) {

    /* ---------- THEME HEADER ---------- */
    const tm = line.match(themeRegex);
    if (tm) {
      currentTheme = {
        title: tm[1].trim(),
        items: []
      };
      themes.push(currentTheme);
      lastItem = null;
      continue;
    }

    /* ---------- VOCAB ITEM ---------- */
    const vm = line.match(vocabRegex);
    if (vm && currentTheme) {
      lastItem = {
        g: vm[1].trim(),
        e: vm[2].trim(),
        satz: "",
        satz_en: ""
      };
      currentTheme.items.push(lastItem);
      continue;
    }

    /* ---------- SATZ (German example) ---------- */
    const sm = line.match(satzRegex);
    if (sm && lastItem) {
      lastItem.satz = sm[1].trim();
      continue;
    }

    /* ---------- TRANSLATION (English example) ---------- */
    const tm2 = line.match(translRegex);
    if (tm2 && lastItem) {
      lastItem.satz_en = tm2[1].trim();
      continue;
    }
  }

  return themes;
}

/* -----------------------------
   FLATTEN FOR CARD VIEW
----------------------------- */
function flatten(themes){
  let out = [];
  themes.forEach(t=>{
    t.items.forEach(word=>{
      out.push({
        theme: t.title,
        ...word
      });
    });
  });
  return out;
}

/* -----------------------------
   RENDERING
----------------------------- */
function renderCards(){
  const root = document.getElementById("cardsRoot");
  root.innerHTML = "";

  cards.forEach((c,i)=>{
    const card = document.createElement("div");
    card.className = "card";
    card.dataset.index = i;

    card.style.transform = `translateY(${(i-index)*110}%)`;

    card.innerHTML = `
      <div class="theme">
        <div class="title">${c.theme}</div>
      </div>

      <div class="content">
        <h1 class="german">${c.g}</h1>
        <div class="english">${c.e}</div>

        <div class="example-box">
          <strong>Satz:</strong> ${c.satz}<br><br>
          <strong>EN:</strong> ${c.satz_en}
        </div>
      </div>
    `;

    /* Flip to show example */
    card.addEventListener("click",()=>{
      const box = card.querySelector(".example-box");
      box.style.display = box.style.display==="block" ? "none" : "block";
    });

    root.appendChild(card);
  });

  updateUI();
}

function updateUI(){
  const total = cards.length;
  document.getElementById("countChip").textContent = `${index+1}/${total}`;
  document.getElementById("progressFill").style.width = ((index+1)/total*100)+"%";

  document.querySelectorAll(".card").forEach(card=>{
    const i = +card.dataset.index;
    const offset = i-index;
    card.style.transform = `translateY(${offset*110}%)`;
    card.style.opacity = Math.abs(offset)>2 ? "0" : "1";
  });
}

/* -----------------------------
   NAVIGATION
----------------------------- */
function next(){ index = (index+1)%cards.length; updateUI(); }
function prev(){ index = (index-1+cards.length)%cards.length; updateUI(); }

document.getElementById("nextBtn").onclick = next;
document.getElementById("prevBtn").onclick = prev;

document.getElementById("shuffleBtn").onclick = ()=>{
  cards.sort(()=>Math.random()-0.5);
  index = 0;
  renderCards();
};

document.addEventListener("keydown",e=>{
  if(e.key==="ArrowDown") next();
  if(e.key==="ArrowUp") prev();
});

/* -----------------------------
   TOUCH + WHEEL
----------------------------- */
let startY=null;
document.addEventListener("touchstart",e=>{
  startY=e.touches[0].clientY;
});
document.addEventListener("touchend",e=>{
  let endY=e.changedTouches[0].clientY;
  if(endY < startY-50) next();
  if(endY > startY+50) prev();
});

document.addEventListener("wheel",e=>{
  if(e.deltaY>10) next();
  if(e.deltaY<-10) prev();
});

/* -----------------------------
   LOAD FILE
----------------------------- */
async function loadFile(){
  try{
    const res = await fetch(FILE_URL);
    const raw = await res.text();
    const plain = rtfToText(raw);
    themes = parseNewFormat(plain);
    cards = flatten(themes);
  }catch(e){
    alert("Error loading file.");
    cards = [];
  }

  if(!cards.length){
    cards=[{theme:"Sample",g:"Hallo",e:"Hello"}];
  }

  renderCards();
}

loadFile();
</script>

</body>
</html>
