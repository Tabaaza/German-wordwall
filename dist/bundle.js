(()=>{var p="/mnt/data/file-3.txt",A=`german-wordwall:${p}`,C=`german-wordwall:bookmarks:${p}`,t={themes:[],cards:[],index:0,bookmarks:{},showBookmarks:!1,examMode:!0},s={};function d(e){return document.getElementById(e)}function F(e,r){try{return JSON.parse(e)}catch{return r}}function g(){try{localStorage.setItem(A,String(t.index))}catch{}}function _(e){try{let r=localStorage.getItem(A);if(!r)return 0;let n=parseInt(r,10);if(Number.isInteger(n)&&n>=0&&n<e)return n}catch{}return 0}function R(){t.bookmarks=F(localStorage.getItem(C),{})}function $(){try{localStorage.setItem(C,JSON.stringify(t.bookmarks))}catch{}}function f(e){return`${e.theme||""}|${e.g}|${e.e}`}function w(e){for(let r=e.length-1;r>0;r--){let n=Math.floor(Math.random()*(r+1));[e[r],e[n]]=[e[n],e[r]]}}function N(e){return e.replace(/\\par[d]?/g,`
`).replace(/\\'[0-9a-fA-F]{2}/g,"").replace(/\\[a-zA-Z]+\d* ?/g,"").replace(/[{}]/g,"").replace(/\r/g,`
`)}function O(e){let n=e.replace(/\r/g,`
`).split(`
`).map(m=>m.trim()).filter(Boolean),o=[],c=null,a=null;for(let m of n){let l=m.replace(/^\*\s?/,"").trim(),i=l.match(/^Satz\s*[:：]?\s*(.+)$/i);if(i&&a){a.satz=i[1].trim();continue}let u=l.match(/^Translation\s*[:：]?\s*(.+)$/i);if(u&&a){a.satz_en=u[1].trim();continue}let x=l.match(/^(?:\d+\.\s*)?(.+?)\s*-\s*(.+)$/);if(x){c||(c={title:"Misc",items:[]},o.push(c)),a={g:x[1].trim(),e:x[2].trim(),satz:"",satz_en:""},c.items.push(a);continue}let v=l.match(/^(\d+)\.\s*(.+)$/);if(v){c={title:v[2].trim(),items:[]},o.push(c),a=null;continue}}return o}function z(e){let r=[];return e.forEach(n=>n.items.forEach(o=>r.push({theme:n.title,...o}))),r}function T(e){let r=e.e,n=t.cards.map(a=>a.e).filter(a=>a&&a!==r);w(n);let o=n.slice(0,2),c=[{text:r,correct:!0},...o.map(a=>({text:a,correct:!1}))];return w(c),c}function k(){let e=s.cardsRoot;e.innerHTML="";let r=t.showBookmarks?t.cards.filter(o=>t.bookmarks[f(o)]):t.cards,n=document.createDocumentFragment();r.forEach((o,c)=>{let a=document.createElement("article");a.className="card",a.dataset.index=c,a.setAttribute("role","group"),a.style.transform=`translateY(${(c-t.index)*110}%)`;let m=!!t.bookmarks[f(o)];a.innerHTML=`
      <header class="card__theme">
        <h2 class="title">${h(o.theme)}</h2>
        <button class="card__bookmark btn" aria-pressed="${m}" title="Toggle bookmark" data-id="${Y(f(o))}"> ${m?"\u2605":"\u2606"} </button>
      </header>
      <div class="card__content">
        <h3 class="word--german">${h(o.g)}</h3>
        <div class="word--english" aria-hidden="false">${h(o.e)}</div>
        <div class="examples" aria-hidden="true">
          <div><strong>Satz:</strong> ${h(o.satz)}</div>
          <div style="margin-top:8px"><strong>EN:</strong> ${h(o.satz_en)}</div>
        </div>
        <div class="choice-row" aria-hidden="${!t.examMode}"></div>
      </div>
    `,a.addEventListener("click",l=>{if(l.target.closest(".card__bookmark")||l.target.closest(".choice-btn"))return;let i=a.querySelector(".examples"),u=i.getAttribute("aria-hidden")==="false";i.setAttribute("aria-hidden",String(!u))}),n.appendChild(a)}),e.appendChild(n),q(),M()}function q(){s.cardsRoot.querySelectorAll(".card__bookmark").forEach(e=>{e.dataset.bound||(e.dataset.bound="1",e.addEventListener("click",r=>{r.stopPropagation();let n=e.dataset.id;t.bookmarks[n]?(delete t.bookmarks[n],e.setAttribute("aria-pressed","false"),e.textContent="\u2606"):(t.bookmarks[n]=!0,e.setAttribute("aria-pressed","true"),e.textContent="\u2605"),$()}))}),t.examMode&&Array.from(s.cardsRoot.querySelectorAll(".card")).forEach(r=>{let n=Number(r.dataset.index),c=(t.showBookmarks?t.cards.filter(l=>t.bookmarks[f(l)]):t.cards)[n],a=r.querySelector(".choice-row");if(!a)return;a.innerHTML="",T(c).forEach(l=>{let i=document.createElement("button");i.className="choice-btn btn",i.textContent=l.text,i.dataset.correct=l.correct?"1":"0",i.setAttribute("aria-pressed","false"),i.addEventListener("click",u=>{u.stopPropagation(),J(i)}),a.appendChild(i)})})}function J(e){let r=e.closest(".choice-row"),n=Array.from(r.querySelectorAll(".choice-btn"));if(n.forEach(o=>{o.disabled=!0,o.setAttribute("aria-pressed","true")}),e.dataset.correct==="1")e.classList.add("correct"),t.scores=t.scores||{correct:0,wrong:0},t.scores.correct++,y(),b("Correct"),B();else{e.classList.add("wrong");let o=n.find(c=>c.dataset.correct==="1");o&&o.classList.add("correct-border"),t.scores=t.scores||{correct:0,wrong:0},t.scores.wrong++,y(),b("Incorrect"),B()}}function y(){try{localStorage.setItem(`german-wordwall:scores:${p}`,JSON.stringify(t.scores||{correct:0,wrong:0}))}catch{}}function j(){try{t.scores=JSON.parse(localStorage.getItem(`german-wordwall:scores:${p}`))||{correct:0,wrong:0}}catch{t.scores={correct:0,wrong:0}}}function B(){let e=document.getElementById("scoreChip");if(!e)return;let r=t.scores||{correct:0,wrong:0};e.textContent=`${r.correct} \u2713 / ${r.wrong} \u2717`}function b(e){let r=document.getElementById("liveRegion");r&&(r.textContent=e,setTimeout(()=>{r.textContent=""},1200))}function H(){try{let e=JSON.stringify(t.bookmarks||{}),r=new Blob([e],{type:"application/json"}),n=URL.createObjectURL(r),o=document.createElement("a");o.href=n,o.download="bookmarks.json",document.body.appendChild(o),o.click(),o.remove(),URL.revokeObjectURL(n)}catch(e){console.error(e)}}function U(e){let r=new FileReader;r.onload=n=>{try{let o=JSON.parse(n.target.result);typeof o=="object"&&(t.bookmarks=o,$(),k(),b("Bookmarks imported"))}catch{alert("Invalid JSON file")}},r.readAsText(e)}function M(){requestAnimationFrame(()=>{let r=(t.showBookmarks?t.cards.filter(o=>t.bookmarks[f(o)]):t.cards).length||1;s.countChip.textContent=`${Math.min(t.index+1,r)}/${r}`,s.progressFill.style.width=(r?(t.index+1)/r*100:0)+"%",Array.from(s.cardsRoot.querySelectorAll(".card")).forEach(o=>{let a=Number(o.dataset.index)-t.index;o.style.transform=`translateY(${a*110}%)`,o.style.opacity=Math.abs(a)>2?"0":"1"})})}function I(e){let r=t.showBookmarks?t.cards.filter(n=>t.bookmarks[f(n)]).length:t.cards.length;if(!r){t.index=0;return}t.index=(e%r+r)%r,g(),M()}function E(){I(t.index+1)}function S(){I(t.index-1)}function D(){s.nextBtn.addEventListener("click",E),s.prevBtn.addEventListener("click",S),s.shuffleBtn.addEventListener("click",()=>{w(t.cards),t.index=0,g(),k()}),s.toggleBookmarksBtn.addEventListener("click",()=>{t.showBookmarks=!t.showBookmarks,s.toggleBookmarksBtn.textContent=t.showBookmarks?"All":"Bookmarks",t.index=0,g(),k()}),s.examBtn.addEventListener("click",()=>{t.examMode=!t.examMode,s.examBtn.textContent=t.examMode?"Hide Exam":"Show Exam",t.index=0,g(),k()}),s.exportBtn.addEventListener("click",()=>{H()}),s.importBtn.addEventListener("click",()=>{s.importFile.click()}),s.importFile.addEventListener("change",e=>{let r=e.target.files&&e.target.files[0];r&&U(r),s.importFile.value=""}),document.addEventListener("keydown",e=>{if(e.key==="ArrowDown"&&E(),e.key==="ArrowUp"&&S(),["1","2","3"].includes(e.key)){let r=s.cardsRoot.querySelector(".card")}})}async function K(){try{let r=await(await fetch(p)).text(),n=N(r);t.themes=O(n),t.cards=z(t.themes),R(),t.index=_(t.cards.length||1)}catch(e){console.error("file load error",e),t.cards=[]}t.cards.length||(t.cards=[{theme:"Sample",g:"Hallo",e:"Hello",satz:"",satz_en:""}]),k()}function h(e){return e?e.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;"):""}function Y(e){return(e||"").replaceAll('"','"')}function L(){s.cardsRoot=d("cardsRoot"),s.countChip=d("countChip"),s.progressFill=d("progressFill"),s.nextBtn=d("nextBtn"),s.prevBtn=d("prevBtn"),s.shuffleBtn=d("shuffleBtn"),s.toggleBookmarksBtn=d("toggleBookmarksBtn"),s.examBtn=d("examBtn"),s.exportBtn=d("exportBtn"),s.importBtn=d("importBtn"),s.importFile=d("importFile"),s.scoreChip=d("scoreChip"),j(),B(),D(),K()}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",L):L();})();
